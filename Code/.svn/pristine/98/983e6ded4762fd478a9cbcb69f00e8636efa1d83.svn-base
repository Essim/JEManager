package ucc;

import java.util.List;
import java.util.stream.Collectors;

import biz.Company;
import biz.CompanyDto;
import biz.ContactDto;
import persistence.UnitOfWorkImpl;
import persistence.dao.CompanyDao;
import util.Util;

public class CompanyUccImpl implements CompanyUcc {

  private CompanyDao companyDao;
  private UnitOfWorkImpl unit;

  /**
   * @author Maniet.Alexandre
   * @param companyDao The ucc's associated dao
   * @param dalServices An instance of dalServices needed for transactions
   * @param userUcc An instance of userUcc needed for returning complete Company objects (depends on
   *        fetching a user from an ID)
   */
  public CompanyUccImpl(CompanyDao companyDao, UnitOfWorkImpl unit) {
    this.companyDao = companyDao;
    this.unit = unit;
  }

  @Override
  public List<CompanyDto> getAllCompanies() {
    return companyDao.selectAll().stream().map(c -> (CompanyDto) c).collect(Collectors.toList());
  }

  @Override
  public CompanyDto getCompanyById(int idCompany) {
    CompanyDto toReturn = companyDao.getCompanyById(idCompany);
    if (toReturn == null) {
      return null;
    }
    return toReturn;
  }

  @Override
  public List<CompanyDto> getCompaniesToInvite() {
    return companyDao.getCompaniesToInvite().stream().map(c -> (CompanyDto) c)
        .collect(Collectors.toList());
  }

  @Override
  public CompanyDto addCompany(CompanyDto companyDto) {
    // Starting a database transaction
    unit.startTransaction();
    // Checking argument
    if (companyDto == null) {
      throw new IllegalArgumentException();
    }
    // Casting dto to full object
    Company company = (Company) companyDto;
    // Inserting the company into the database using the dao and retrieving the inserted object
    unit.addInsert(company);
    // Committing and closing the transaction
    unit.commit();
    return company;
  }

  @Override
  public List<ContactDto> getMyContacts(CompanyDto companyDto) {
    Util.checkNull(companyDto);
    return companyDao.getMyContacts((Company) companyDto).stream().map(c -> (ContactDto) c)
        .collect(Collectors.toList());
  }

}
